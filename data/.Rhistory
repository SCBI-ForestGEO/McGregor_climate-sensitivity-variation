bic_top <- all_models_bic[seq(1,nrow(all_models_bic), 4), ]
##2c. run the best model ####
#the overall top result appears to be the full model. Thus, we use that model below.
clim_anova <- NULL
clim_BIC <- NULL
for (v in seq(along=clim)){
cru_sub <- cru1901_lmm[cru1901_lmm$variable %in% clim[[v]], ]
lmm.full <- lmer(corr ~ position + month + (1 | Species), data=cru_sub, REML=FALSE)
vari_anova <- Anova(lmm.full)
vari_anova$var <- clim[[v]]
clim_anova <- rbind(clim_anova, vari_anova)
#although we compared AIC outside of the loop when determining what model to use here, it's good to also check out BIC for a thorough analysis.
vari_drop1 <- drop1(lmm.full, k = log(nrow(cru_sub))) #because we add k = log(nrow(cru_sub)),                                                             this now shows BIC
vari_drop1$var <- clim[[v]]
clim_BIC <- rbind(clim_BIC, vari_drop1)
q <- qqp(residuals(lmm.full), "norm", main=paste0(clim[[v]], "_residuals"))
print(q)
}
clim_BIC <- setDT(clim_BIC, keep.rownames="aspect")[]
clim_BIC <- setnames(clim_BIC, old="AIC", new="BIC")
clim_BIC$aspect <- gsub("<none>", "full model", clim_BIC$aspect)
clim_BIC$var <- as.character(clim_BIC$var)
colnames(clim_BIC[,3]) <- "BIC"
clim_anova$signif <- ifelse(clim_anova$`Pr(>Chisq)` <0.05, 1, 0)
View(clim_anova)
qqp(residuals(lmm.full), "norm", main="Normal residuals")
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/pdsi_timeseries_winchester_1949-2012.csv")
View(winchester)
winchester <- winchester[winchester$X1.Month < -3, ]
View(winchester)
install.packages("ncdf4")
library(ncdf4)
?ncdf4
library(ncdf4)
library(ncdf4.helpers)
library(ncdf.tools)
install.packages("ncdf.tools")
library(ncdf.tools)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data")
nc <- nc_open("pdsi.mon.mean.selfcalibrated.nc")
View(nc)
print(nc)
attributes(nc$names)
attributes(nc)$names
attributes(nc$var)$names
attributes(nc$dim)$names
plot(nc)
library(raster)
nc_file <- nc_open("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean.selfcalibrated.nc")
pdsi <- brick(nc_file)
fname <- "C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean.selfcalibrated.nc"
pdsi <- brick(nc_file)
install.packages(c("acs", "AICcmodavg", "bookdown", "broom", "callr", "carData", "checkmate", "classInt", "curl", "data.table", "dbplyr", "dplR", "e1071", "evaluate", "expss", "flextable", "FNN", "forcats", "ggmap", "ggsn", "ggthemes", "ggvis", "git2r", "googleVis", "gstat", "haven", "Hmisc", "htmlTable", "htmlwidgets", "httpuv", "httr", "igraph", "jsonlite", "later", "lemon", "lwgeom", "maptools", "mapview", "markdown", "measurements", "mgcv", "modelr", "nloptr", "officer", "openssl", "packrat", "plotKML", "processx", "ps", "psych", "purrr", "quantreg", "R.utils", "RandomFields", "RandomFieldsUtils", "raster", "rcmdcheck", "RcppEigen", "RCurl", "readxl", "reshape", "rgdal", "rio", "RJSONIO", "rmarkdown", "rsconnect", "sessioninfo", "sf", "shiny", "shinyWidgets", "spam", "spData", "stars", "sys", "testthat", "tidybayes", "tidyr", "tinytex", "tmap", "units", "waveslim", "webshot", "writexl", "xfun", "XML", "xts", "zip"))
install.packages(c("class", "codetools", "mgcv"), lib="C:/Users/mcgregori/Documents/R/R-3.5.2/library")
library(ncdf4)
library(raster)
fname <- "C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean.selfcalibrated.nc"
pdsi <- brick(fname)
pdsi
plot(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
View(scbi)
?extract
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
View(scbi_pdsi)
scbi_pdsi[1, ] <- colnames(scbi_pdsi)
View(scbi_pdsi)
trans <- transpose(scbi_pdsi)
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
View(trans)
colnames(trans) <- "scbi_pdsi"
trans <- setDT(trans, keep.rownames=TRUE)[]
View(trans)
trans <- transpose(scbi_pdsi)
colnames(trans) <- "scbi_pdsi"
trans[,2] <- rownames(trans)
View(trans)
trans <- transpose(scbi_pdsi)
View(trans)
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
View(trans)
colnames(trans) <- c("scbi_pdsi", "date")
trans$date <- gsub("X", "", trans$date)
View(trans)
trans$date <- gsub(".00.00.00", "", trans$date)
View(trans)
range(trans$scbi_pdsi)
range(trans$scbi_pdsi, na.rm=TRUE)
scbi_pdsi <- extract(pdsi, scbi, method="bilinear")
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
range(trans$scbi_pdsi, na.rm=TRUE)
fname <- "C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean..nc"
pdsi <- brick(fname)
library(ncdf4)
library(raster)
fname <- "C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean..nc"
pdsi <- brick(fname)
fname <- "C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi.mon.mean.nc"
pdsi <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
scbi_pdsi <- extract(pdsi, scbi, method="bilinear")
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
range(trans$scbi_pdsi, na.rm=TRUE)
?untar
untar(scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc.gz)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data")
untar("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc.gz", exdir="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data")
untar("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc.gz", exdir="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data", compressed=TRUE)
?gunzip
library(R.utils)
?gunzip
gunzip("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc.gz", destname="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data", remove=FALSE)
gunzip("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc.gz", destname="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/test", remove=FALSE)
gunzip("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017_nc.gz", destname="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/test", remove=FALSE)
library(R.utils)
setwd("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data")
gunzip("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017_nc.gz", destname="C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/test", remove=FALSE)
fname <- "scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017_nc.gz"
library(ncdf4)
library(raster)
pdsi <- brick(fname)
gunzip("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017_nc.gz", remove=FALSE)
fname <- "scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc"
pdsi <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
scbi_pdsi <- extract(pdsi, scbi, method="bilinear")
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
View(trans)
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
View(scbi_pdsi)
print(scbi_pdsi)
nc <- nc_open("scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc")
print(nc)
lon <- ncvar_get(nc, attributes(nc$dim)$names[1])
lat <- ncvar_get(nc, attributes(nc$dim)$names[2])
print(paste(dim(lat), "latitudes and", dim(lon), "longitudes"))
attributes(nc$dim)$names
attributes(nc$vars)$names
attributes(nc$var)$names
range(attributes(nc$dim)$names[1]
)
summary(lon)
summary(lat)
View(scbi)
#6.Make sure that the connection works by getting a description of what's inside the file.
print(nc)
#7. To see basic attributes of the file, use the attributes function.
attributes(nc)$names
#8. To see a list of the nc variable names, use a similar function.
attributes(nc$var)$names
#10. Get values for latitude and longitude from the file.
attributes(nc$dim)$names
ncatt_get(nc, attributes(nc$dim)$names)
ncatt_get(nc, attributes(nc$dim)$names[3])
time <- ncvar_get(nc, varid = "time") #necessary to do this step for 11c.1
##11c. If you want to see the timescale scope, you view the time series.
dswrf <- nc.get.time.series(nc, v = "dswrf", time.dim.name = "time")
library(ncdf4.helpers)
##11c. If you want to see the timescale scope, you view the time series.
dswrf <- nc.get.time.series(nc, v = "dswrf", time.dim.name = "time")
?nc.get.time.series
##11c. If you want to see the timescale scope, you view the time series.
dswrf <- nc.get.time.series(nc, v = "scpdsi", time.dim.name = "time")
##11c. If you want to see the timescale scope, you view the time series.
dswrf <- nc.get.time.series(nc)
time
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01", tz = "UTC"), time.format = c("%Y-%m-%d"))
library(ncdf.tools)
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01", tz = "UTC"), time.format = c("%Y-%m-%d"))
timetrue
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
timetrue
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
View(trans)
colnames(trans) <- c("scbi_pdsi", "date")
trans$date <- timetrue
View(trans)
range(trans$scbi_pdsi, na.rm=TRUE)
plot(trans)
trans$scbi_pdsi <- as.numeric(trans$scbi_pdsi)
range(trans$scbi_pdsi, na.rm=TRUE)
fname <- "pdsi.mon.mean.selfcalibrated.nc"
pdsi <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
View(trans)
trans$scbi_pdsi <- as.numeric(trans$scbi_pdsi)
range(trans$scbi_pdsi)
range(trans$scbi_pdsi, na.rm=TRUE)
plot(fname)
fname <- "scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc" #from CRU
pdsi <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
scbi_pdsi <- extract(pdsi, scbi)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
trans$date <- timetrue
View(trans)
win <- data.frame("lon" = 78.1633, "lat" = 39.1857)
pdsi <- brick(fname)
scbi_pdsi <- extract(pdsi, win)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
View(trans)
trans$date <- timetrue
trans$scbi_pdsi <- as.numeric(trans$scbi_pdsi)
range(trans$scbi_pdsi)
View(trans)
trans <- trans[,2,1]
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
trans$date <- timetrue
trans$scbi_pdsi <- as.numeric(trans$scbi_pdsi)
range(trans$scbi_pdsi)
trans <- trans[,c(2,1)]
View(trans)
plot(trans)
library(esquisse)
esquisse:::esquisser()
scbi_pdsi <- extract(pdsi, win)
scbi_pdsi <- data.frame(scbi_pdsi)
scbi_pdsi[2, ] <- colnames(scbi_pdsi)
library(data.table)
trans <- transpose(scbi_pdsi)
colnames(trans) <- c("scbi_pdsi", "date")
View(trans)
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/pdsi_timeseries_winchester_1949-2012.csv")
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
plot(winchester)
View(winchester)
esquisse:::esquisser()
winchester$Date <- as.POSIXct(winchester$Date, tz = "EST")
View(winchester)
?as.POSIXct
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
winchester$Date <- strptime(winchester$Date, format = "%d-%m-%Y")
View(winchester)
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
winchester$Date <- as.character(winchester$Date)
winchester$Date <- strptime(winchester$Date, format = "%d-%m-%Y")
View(winchester)
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
winchester$Date <- as.character(winchester$Date)
winchester$Date <- strptime(winchester$Date)
winchester$Date <- strptime(winchester$Date, format="%Y-%m-%d")
View(winchester)
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
winchester$Date <- as.character(winchester$Date)
winchester$Date <- as.Date(winchester$Date)
View(winchester)
#this data comes from: https://droughtatlas.unl.edu/Data.aspx
winchester <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
View(winchester)
winchester$Date <- as.character(winchester$Date)
winchester$Date <- strptime(winchester$Date, format = "%d/%m/%Y")
View(winchester)
plot(winchester)
esquisse:::esquisser()
winchester$Date <- as.POSIXct(winchester$Date, format = "%d/%m/%Y")
View(winchester)
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
View(win_pdsi)
winchester$Date <- as.POSIXct(winchester$Date, format = "%d/%m/%Y")
colnames(win_pdsi) <- c("date", "pdsi")
win_pdsi$date <- as.POSIXct(win_pdsi$date, format = "%d/%m/%Y")
View(win_pdsi)
win_scpdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/scpdsi_timeseries_winchester_1949-2012.csv")
View(win_scpdsi)
colnames(win_scpdsi) <- c("date", "scpdsi")
win_scpdsi$date <- as.POSIXct(win_scpdsi$date, format = "%d/%m/%Y")
View(win_scpdsi)
winchester <- cbind(win_pdsi, win_scpdsi)
View(winchester)
winchester <- merge(win_pdsi, win_scpdsi)
View(winchester)
#CRU
fname <- "I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc" #from CRU
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
cru_scpdsi <- brick(fname)
library(raster)
library(ncdf4)
library(ncdf4.helpers)
library(ncdf.tools)
#CRU
fname <- "I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc" #from CRU
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
?timetrue
library(ncdf4.helpers)
library(ncdf.tools)
?timetrue
?convertDateNcdf2R
cru <- nc_open("I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc")
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
time <- ncvar_get(cru, varid = "time")
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
cru_scpdsi <- brick(fname)
cru <- data.frame("lon" = 78.1653, "lat" = 38.8871)
cru_scpdsi <- extract(scpdsi, win)
cru_scpdsi <- data.frame(cru_scpdsi)
cru_scpdsi <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
cru_nc <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
cru_scpdsi <- extract(scpdsi, scbi)
cru_scpdsi <- extract(cru_nc, scbi)
cru_scpdsi <- data.frame(cru_scpdsi)
cru_scpdsi[2, ] <- colnames(cru_scpdsi)
library(data.table)
trans <- transpose(cru_scpdsi)
colnames(trans) <- c("cru_scpdsi", "date")
trans$date <- timetrue
trans$cru_scpdsi <- as.numeric(trans$cru_scpdsi)
trans <- trans[,c(2,1)]
View(trans)
all_values <- merge(winchester, trans)
View(all_values)
all_values <- merge(trans, winchester)
all_values <- merge(trans, winchester, all=TRUE)
rm(all_values)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
library(lubridate)
win_pdsi$date <- ymd(win_pdsi$date)
View(win_pdsi)
#National drought monitor ####
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
colnames(win_pdsi) <- c("date", "win_pdsi")
win_pdsi$date <- ymd(win_pdsi$date)
?as.POSIXct
?as.POSIXct.Date
win_pdsi$date <- format(win_pdsi$date, "%Y/%m/%d")
View(win_pdsi)
#National drought monitor ####
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
colnames(win_pdsi) <- c("date", "win_pdsi")
win_pdsi$date <- as.POSIXct(win_pdsi$date, format = "%d/%m/%Y")
win_pdsi$date <- format(win_pdsi$date, "%Y/%m/%d")
View(win_pdsi)
#National drought monitor ####
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
colnames(win_pdsi) <- c("date", "win_pdsi")
View(win_pdsi)
win_pdsi$date <- as.POSIXct(win_pdsi$date, format = "%m/%d/%Y")
View(win_pdsi)
library(raster)
library(ncdf4)
library(ncdf4.helpers)
library(ncdf.tools)
library(lubridate)
#National drought monitor ####
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
colnames(win_pdsi) <- c("date", "win_pdsi")
win_pdsi$date <- as.POSIXct(win_pdsi$date, format = "%m/%d/%Y")
win_scpdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/scpdsi_timeseries_winchester_1949-2012.csv")
colnames(win_scpdsi) <- c("date", "win_scpdsi")
win_scpdsi$date <- as.POSIXct(win_scpdsi$date, format = "%m/%d/%Y")
winchester <- merge(win_pdsi, win_scpdsi)
fname <- "I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc" #from CRU
cru <- nc_open("I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc")
time <- ncvar_get(cru, varid = "time")
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
cru_nc <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
cru_scpdsi <- extract(cru_nc, scbi)
cru_scpdsi <- data.frame(cru_scpdsi)
cru_scpdsi[2, ] <- colnames(cru_scpdsi)
library(data.table)
trans <- transpose(cru_scpdsi)
colnames(trans) <- c("cru_scpdsi", "date")
trans$date <- timetrue
trans$cru_scpdsi <- as.numeric(trans$cru_scpdsi)
trans <- trans[,c(2,1)]
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
View(trans)
trans$date <- gsub("01.00", "00.00", trans$date)
View(trans)
trans$date <- timetrue
View(trans)
trans$date <- gsub("01:00", "00:00", trans$date)
View(trans)
trans$scbi_pdsi <- as.numeric(trans$scbi_pdsi)
trans$cru_scpdsi <- as.numeric(trans$cru_scpdsi)
all_values <- merge(winchester, trans, all=TRUE)
View(all_values)
all_values <- merge(winchester, trans, all.y=TRUE)
View(all_values)
all_values <- merge(winchester, trans)
all_values <- merge(trans, winchester)
all_values <- merge(trans, winchester, all=TRUE)
trans$date <- format(trans$date, "%Y-%m-%d")
trans$date <- as.POSIXct(win_pdsi$date, format = "%Y-%m-%d %H:%M:%OS")
trans$date <- timetrue
trans$date <- as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS")
View(trans)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
trans$date <- timetrue
trans$date <- format(as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS"), format="%Y-%m-%d")
View(trans)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
trans$date <- timetrue
trans$date <- format(as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS"), format="%Y-%m-%d")
View(trans)
trans$date <- timetrue
trans$date <- as.Date(mdy_hms(trans$date))
trans$date <- as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS")
trans$date <- as.Date(mdy_hms(trans$date))
View(trans)
trans$date <- timetrue
trans$date <- as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS")
trans$date <- as.Date(mdy_hms(trans$date))
trans$date <- timetrue
trans$date <- as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS")
View(trans)
trans$date <- as.Date(trans$date)
View(trans)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
win_scpdsi$date <- as.POSIXct(win_scpdsi$date, format = "%m/%d/%Y")
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
library(raster)
library(ncdf4)
library(ncdf4.helpers)
library(ncdf.tools)
library(lubridate)
#National drought monitor ####
win_pdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/pdsi_timeseries_winchester_1949-2012.csv")
colnames(win_pdsi) <- c("date", "win_pdsi")
win_pdsi$date <- as.POSIXct(win_pdsi$date, format = "%m/%d/%Y")
win_scpdsi <- read.csv("C:/Users/mcgregori/Dropbox (Smithsonian)/Github_Ian/tree-growth-and-traits/data/scpdsi_timeseries_winchester_1949-2012.csv")
colnames(win_scpdsi) <- c("date", "win_scpdsi")
win_scpdsi$date <- as.POSIXct(win_scpdsi$date, format = "%m/%d/%Y")
winchester <- merge(win_pdsi, win_scpdsi)
#CRU ####
# https://crudata.uea.ac.uk/cru/data/drought/
fname <- "I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc" #from CRU
cru <- nc_open("I:/Krista Lab/Netcdf PDSI values/scPDSI.cru_ts3.26early.bams2018.GLOBAL.1901.2017.nc")
time <- ncvar_get(cru, varid = "time")
#CRU data shows time as days since 1900-01-01.
timetrue <- convertDateNcdf2R(time, units = "days", origin = as.POSIXct("1900-01-01"), time.format = c("%Y-%m-%d"))
cru_nc <- brick(fname)
scbi <- data.frame("lon" = 78.1653, "lat" = 38.8871)
cru_scpdsi <- extract(cru_nc, scbi)
cru_scpdsi <- data.frame(cru_scpdsi)
cru_scpdsi[2, ] <- colnames(cru_scpdsi)
library(data.table)
trans <- transpose(cru_scpdsi)
colnames(trans) <- c("cru_scpdsi", "date")
trans$date <- timetrue
trans$date <- as.POSIXct(trans$date, format = "%Y-%m-%d %H:%M:%OS")
trans$date <- as.Date(trans$date)
trans$cru_scpdsi <- as.numeric(trans$cru_scpdsi)
trans <- trans[,c(2,1)]
all_values <- merge(trans, winchester, all=TRUE)
win_pdsi$date <- as.Date(win_pdsi$date)
win_scpdsi$date <- as.Date(win_scpdsi$date)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
class(win_pdsi$date)
class(win_scpdsi)
winchester <- merge(win_pdsi, win_scpdsi)
all_values <- merge(trans, winchester, all=TRUE)
View(all_values)
