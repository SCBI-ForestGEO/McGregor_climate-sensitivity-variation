# Basic intro using RMarkdown and/or Bookdown
for journal articles or dissertation

## RMarkdown
- "RMarkdown" = is a formatting style, which is used in .Rmd files. These can be knit separately to make individual PDFs or html files and, if desired, a full article can be written in a single .Rmd file.

See a [guide](https://bookdown.org/yihui/rmarkdown/) to RMarkdown syntax, or see an example of a [github repo](https://github.com/dr-harper/rmarkdown-cookbook) with the files used for bookdown.

## Bookdown
- "Bookdown" = the system for compiling a lot of separate .Rmd or .md files together. This system requires more files (.yml, YAML, .bib, etc).

### File terms
#### .Rmd, .md
.Rmd = RMarkdown file, and .md = Markdown file. These are the files that are each chapter or section in the book, numbered in numerical order: 01-intro.Rmd, 02-Methods.Rmd, etc. The difference between the two is dependent on your content. If you are using figures and inline code, you need .Rmd, but if you're using only text (like a novel), .md works. Each of these chapter files must start with a title header:

- 01-intro.Rmd
   
    ```
    # Introduction
    
    Yay a book wow
    ```

#### .yml, .yaml
YAML = YAML Ain't Markup Language. Basically, it's a type of language for writing that is recognized by coding programs (e.g. R code recognizes "#" as a comment - that sort of thing). YAML is used primarily for data usage, and it has a specific style that is apparent in _bookdown.yml files. For more examples, see [here](https://en.wikipedia.org/wiki/YAML).

If you use _bookdown.yml, you can specify the order of your .Rmd files by using
    rmd_files: ["index.Rmd", "abstract.Rmd", "intro.Rmd"]


### File Types
#### index.Rmd
Your first Markdown file for the book should be index.Rmd; this is where you define things about the book. For example,

    ```
    ---
    title: "Tree size, exposure, and hydraulic traits interactively shape drought response in a    temperate broadleaf forest"
    author: "Ian McGregor, Ryan Helcoski, Norbert Kunert, Alan Tepley, Valentine Herrmann, Neil    Pederson, Lawren Sack, Krista Anderson-Teixeira"
    output: html_document
    documentclass: book
    bibliography: [book.bib]
    biblio-style: apalike
    link-citations: yes
    github-repo: manuscript/outline
    description: "Article for Ian's research during his time in Anderson-Teixeira lab"
    ---
    ```
The options to include for index.Rmd are 

- title, 

- subtitle, 

- author (can be list [-] on multiple lines), 

- date, 

- output, 

- documentclass, 

- bibliography, 

- biblio-style, 

- link-citations, 

- github-repo, 

- description, 

- geometry (for specifying margins, very useful for pdf), 

- fontsize, 

- linestretch, 

- toc-depth (how many numbered sections to include in table of contents), 

- lof (list of figures [either TRUE or FALSE]), 

- lot (list of tables [either TRUE or FALSE]), 

- classoption ("oneside" or "twoside").

See [this site](https://eddjberry.netlify.com/post/writing-your-thesis-with-bookdown/) for examples when writing to a pdf for a thesis

 - this site also includes useful formatting for using LaTex to turn off, say, hyphenation across multiple lines, which is explained more in-depth [here](https://bookdown.org/yihui/bookdown/yaml-options.html)

### Writing Advice with Rmarkdown
These come from [here](https://eddjberry.netlify.com/post/writing-your-thesis-with-bookdown/)(also cited in other sections here)

1. Have each sentence on a separate line (this makes it easier to keep track of changes and quickly look over references at line ends). 

2. You can keep R-code separate, then use save.image() to save R env, which can then be read into the Rmarkdown env with all the results from the code. Plus, saving that info as a separate R.Data file allows you to use that in other places too.

3. Save figures in separate folders as well. 

### Add an image
Adding an image: make sure your working directory is set. Let's say I have an image in the "maps" folder. To add it in the chapter, I simply put in  `![captionofmap](maps/file_name.jpg)` and a blank box is inserted beneath my script. To see what this looks like in the actual book, you can knit the book.

### References with .bib
Citations are can be made in two ways. The easier way is via Zotero.

**As with all edits, please make sure you've fetched origin and your local files are updated before making/committing changes.**

#### Create the citation with Zotero

1. Install [Zotero](https://www.zotero.org/download/) for desktop and the plug-in for Chrome (if not using Chrome, that's ok. It will just take a little bit more effort).

2. Open  Zotero application (not the plugin)
- Click on 'file' -> 'import' -> 'next >'
- Select 'book.bibtex' file (extension is 'bibtex document')
- Make sure to check the 'Place imported collections...' box and click 'next >'
**Important**: Because Zotero automatically saves reference lists you make, you must import to a new collection every time you open, and only work out of that collection. Zotero will say you have duplicates, but that's because it's saving your first list you opened, and it doesn't automatically udpate from Github.
- Once you've imported to a new collection, you can just delete the old collection to avoid confusion when you're working

3. Add a citation either from the plug-in (super easy, just click on the icon when you're on the article or web page you wish to cite) or via manual entry.

4. Review the fields to make sure data is correct. Please remove abstract if automatically populated.

5. When done adding citations, order them by "Creator". 
**IMPORTANT** Select all your items in the collection, right click, and select *Export Items*. Change format to *BibTex* and make sure *Export Notes* is checked.

6. Save the file as **book.bib** and overwrite existing one.
- When looking to see if the file has been saved, the name of the file may show up as 'book.'

7. If you want to see how Bookdown views the file, open book.bib in RStudio. The file will now have your citation looking like this:
      ```
       @article{stovall_assessing_2018,
         title = {Assessing terrestrial laser scanning for developing non-destructive biomass allometry},
	        volume = {427},
	        issn = {0378-1127},
	        url = {http://www.sciencedirect.com/science/article/pii/S0378112718304663},
	        doi = {10.1016/j.foreco.2018.06.004},
	        urldate = {2018-11-26},
	        journal = {Forest Ecology and Management},
	        author = {Stovall, Atticus E. L. and Anderson-Teixeira, Kristina J. and Shugart, Herman H.},
	        month = nov,
	        year = {2018},
	        keywords = {Carbon, Forest structure, Large trees, Quantitative structure models, Sample size, Scaling theory, Terrestrial LiDAR},
	        pages = {217--229},
	        file = {ScienceDirect Full Text PDF:C\:\\Users\\mcgregori\\Zotero\\storage\\DP7LXP7I\\Stovall et al. - 2018 - Assessing terrestrial laser scanning for developin.pdf:application/pdf;ScienceDirect Snapshot:C\:\\Users\\mcgregori\\Zotero\\storage\\I4JV9V4V\\S0378112718304663.html:text/html}
        }
      ```
- for reference, this citation is from [this article](https://www.sciencedirect.com/science/article/pii/S0378112718304663). The `file =` part is Zotero saving a local copy of the article pdf.

#### Create the citation manually

If Zotero isn't working, citations can also be made manually. To do this, open the book.bib file in RStudio, and add the information for your citation. Use the [BibTex documentation] link below for guidance.
- your citation should also look like Step 7 above (the `file =` part is irrelevant).

#### Cite the citation in-text
8. In the citation above, the relevant part for in-text citing is the very first part of the code. Above the `title` is a character string called the "citation key". This is the text you write to tell Bookdown to generate a citation.

9. For example, there is a sentence from this article: "Trees are good." To cite this article, I use [@citation key] (see the [markdown] link below for other variations]. In the .Rmd file, I would write `Trees are good [@stovall_assessing_2018].` When the book is knit or rendered, Bookdown automatically converts this to:

`Trees are good (Stovall, Anderson-Teixeira, and Shugart 2018).` with the following reference appended to the text:

`Stovall, Atticus E. L., Kristina J. Anderson-Teixeira, and Herman H. Shugart. 2018. “Assessing Terrestrial Laser Scanning for Developing Non-Destructive Biomass Allometry.” Forest Ecology and Management 427 (November): 217–29. doi:10.1016/j.foreco.2018.06.004.`

- Helpfully, the year automatically links to the full appended reference.

#### Reference Order

References in each chapter are ordered by appearance in the text.

References for the whole book (in the final book chapter) are ordered alphabetically by author.

#### References for how to make a citation:

Exporting from Zotero: [UniMelbourne](http://unimelb.libguides.com/c.php?g=565734&p=3897111)

Manual citation entry in book.bib: [BibTex documentation](https://en.wikipedia.org/wiki/BibTeX)

Bookdown info for citations: [Yihui](https://bookdown.org/yihui/bookdown/citations.html)

Markdown syntax for in-text citations (and other info): [markdown](https://rmarkdown.rstudio.com/authoring_bibliographies_and_citations.html)

### Updating the book

First and foremost, install Knit and bookdown. 

IMPORTANT: If using RProject, you can ONLY render a book if all the .Rmd file components of the book (all your chapters) are in the top folder of the project. You can have the figures and tables in subfolders, but otherwise everything must be in the top source folder.
       
       install.packages("knitr", "bookdown")
       setwd("localpath/Github/SCBI-Plot-Book")

There are two ways of updating.

#### Updating your chapter via Knitting

The first, and easiest way, is via the "Knit" function.

4. Once knitr is installed, a ball of yarn with a needle will appear on the banner of your .Rmd script in RStudio. 

5. When you want to update the chapter (**or, view a preview of what the chapter will look like online**), select "Knit". This will simultaneously save the .Rmd file and update your chapter's html file as well. A blank window will pop up, then select "Open in Browser."

6. Running the Knit function will apply the same code as below in Step 7 with the same outputs. The differences are that Knit will automatically open a prompt to view the updated file, *and* it will only update the specific chapter you're working on.

#### Updating the whole book (including your new chapter)

The second way of updating is by putting together all the elements of the book and updating them all at once (called rendering).

7. Run the following command to put the book together (known as "rendering").

       bookdown::render_book("manuscript/outline/index.Rmd")

8. Your ouput will look something like this:

       processing file: _main.Rmd
        |.................................................................| 100%
        ordinary text without R code
       output file: _main.knit.md

       "C:/Program Files/RStudio/bin/pandoc/pandoc" +RTS -K512m -RTS _main.utf8.md --to html4 --from markdown+autolink_bare_uris+ascii_identifiers+tex_math_single_backslash --output _main.html --smart --email-obfuscation none --standalone --section-divs --table-of-contents --toc-depth 3 --template "C:\Users\mcgregori\Documents\R\win-library\3.5\bookdown\templates\gitbook.html" --highlight-style pygments --number-sections --css style.css --include-in-header "C:\Users\MCGREG~1\AppData\Local\Temp\14\Rtmp8WwPNp\rmarkdown-str397c787bde.html" --mathjax --filter pandoc-citeproc 

       Output created: _book/introduction.html
       [1] "localpath/Github/SCBI-Plot-Book/_book/introduction.html"
       Warning message:
       In split_chapters(output, gitbook_page, number_sections, split_by,  :
          You have 7 Rmd input file(s) but only 6 first-level heading(s). Did you forget first-level headings in certain Rmd files?

9. The important part is "Output created." This means the html files have been updated and are in the \_book folder. The warning message refers to the lack of a header (H1 #) in the index.Rmd. This is fine.

10. From your local Github folder on your computer, you can now open the html file associated with your edited chapter and review how it looks.

11. When finished, please remember to commit and push back to Github. When pushing after doing the rendering command, you'll notice there are several changed files that have a .css, .js, and .json extensions. These refer to the elements of the web visualization and as such are necessary to be pushed as well.

#### Live-streaming your book updates
Instead of updating the book constantly using render_book, you can also have your updates be automatically viewed next to you as you write - all you have to do is save the output.

```
serve_book(dir = ".", output_dir = "_book", preview = TRUE, in_session = TRUE, quiet = FALSE, ...)
```

"If it does not really take too much time to recompile the whole book, you may set the argument preview = FALSE, so that every time you update the book, the whole book is recompiled, otherwise only the modified chapters are recompiled via preview_chapter()." see [source](https://bookdown.org/yihui/bookdown/serve-the-book.html)