interpDEM <- interpolate(contourRaster, g)
contour5m
contourBBox <- bbox(contour5m)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]))
res(contourRaster) <- 20
p <- as(contour5m, 'SpatialPointsDataFrame')
library(gstat)
g <- gstat(id="ELEV_M", formula = ELEV_M~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+init=epsg:26917"))
res(contourRaster) <- 20
p <- as(contour5m, 'SpatialPointsDataFrame')
g <- gstat(id="ELEV_M", formula = ELEV_M~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
contourBBox <- bbox(contour5m)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(contourRaster) <- 20
p <- as(contour5m, 'SpatialPointsDataFrame')
g <- gstat(id="ELEV_M", formula = ELEV_M~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
View(p)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
sp.lines(contour5m, col = "black")
spplot(interpDEM, col.regions = heat.colors(100),
xlim=c(bbox(interpDEM)[1,1] + 900,
bbox(interpDEM)[1,2] - 900),
ylim=c(bbox(interpDEM)[2,1] + 1150,
bbox(interpDEM)[2,2] - 900),
colorkey = list(space = "top", width = 1), main = "Elev. (m)",
panel = function(x, y, ...){
panel.gridplot(x,y, ...)
sp.lines(contour5m, col = "black")
})
plot(interpDEM)
View(interpDEM)
View(g)
View(p)
p$CONTOUR <- as.numeric(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
View(p)
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR
p$CONTOUR <- as.character(p$CONTOUR)
p$CONTOUR
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
View(p)
res(contourRaster) <- 19
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
res(contourRaster) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
res(contourRaster) <- 20
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
data("brompton")
# Upslope area and wetness index for Brompton catchment
layers <- build_layers(brompton$dem)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
?upslope.area
res(contourRaster) <- 40
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
res(contourRaster) <- 10
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
?get_elev_raster
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
q <- get_elev_raster(r, z=10)
proj4string(r) <- CRS("+init=epsg:26917")
q <- get_elev_raster(r, z=10)
plot(q)
res(q) <- 10
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+init=epsg:26917"))
res(q) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(contourRaster, g)
layers <- build_layers(interpDEM$CONTOUR.pred)
res(q)
res(interpDEM)
plot(interpDEM)
View(p)
interpDEM <- interpolate(q, g)
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=10)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=10)
plot(q)
mask(q, r)
q
r
?mask
crop(q, r)
plot(crop(q, r))
q <- get_elev_raster(r, z=1)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
?get_elev_raster
q <- get_elev_raster(r, z=1)
res(q)
plot(q)
plot(q)
q <- get_elev_raster(r, z=1)
q <- get_elev_raster(r, z=2)
q <- get_elev_raster(r, z=10)
q <- get_elev_raster(r, z=8)
q <- get_elev_raster(r, z=5)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
plot(q)
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
# layers <- build_layers(interpDEM$CONTOUR.pred)
layers <- build_layers(q$layer)
interpDEM <- interpolate(q, g)
layers <- build_layers(interpDEM$CONTOUR.pred)
res(q)
res(q) <- c(5,5)
plot(q#
plot(q)
plot(q)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 21
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 21
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 4
p <- as(contour5m, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
plot(contourRaster)
p <- as(q, 'SpatialPointsDataFrame')
p$CONTOUR <- as.character(p$CONTOUR)
View(p)
p$CONTOUR <- as.character(p$layer)
g <- gstat(id="CONTOUR", formula = CONTOUR~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
plot(interpDEM)
layers <- build_layers(interpDEM$CONTOUR.pred)
?gstat
p <- as(q, 'SpatialPointsDataFrame')
p$layer <- as.character(p$layer)
g <- gstat(id="layer", formula = layer~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
layers <- build_layers(interpDEM$CONTOUR.pred)
layers <- build_layers(interpDEM$layer.pred)
res(q)
res(q) <- 4
p <- as(q, 'SpatialPointsDataFrame')
p$layer <- as.character(p$layer)
g <- gstat(id="layer", formula = layer~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
plot(interpDEM)
layers <- build_layers(interpDEM$layer.pred)
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
q <- get_elev_raster(r, z=14)
res(q)
plot(q)
q <- crop(q, r)
plot(q)
contourBBox <- bbox(q)
contourRaster <- raster(xmn=contourBBox[1,1],
xmx=ceiling(contourBBox[1,2]),
ymn=contourBBox[2,1],
ymx=ceiling(contourBBox[2,2]),
crs = CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0"))
res(q) <- 4
p <- as(q, 'SpatialPointsDataFrame')
p$layer <- as.character(p$layer)
g <- gstat(id="layer", formula = layer~1, data=p,
nmax=7, set=list(idp = .5))
interpDEM <- interpolate(q, g)
plot(interpDEM)
layers <- build_layers(interpDEM$layer.pred)
p$layer
p <- as(q, 'SpatialPointsDataFrame')
p$layer
p@data <- data.frame(layer = as.character(p$layer))
p@data
p
res(p)
?build_layers
build_layers(q)
q
plot(q)
q <- get_elev_raster(r, z=14)
res(q)
res(q) <- 4
res(q)
plot(q)
q <- get_elev_raster(r, z=14)
plot(q)
res(q) <- 4
plot(q)
res(r)
?get_elev_raster
q <- get_elev_raster(r, z=14)
rasterize(q, r)
raster(q)
resample(q, r)
q <- resample(q, r)
res(q)
plot(q)
layers <- build_layers(q)
?resample
q <- get_elev_raster(r, z=14)
xy[1]
xy
xy
r <- raster(ext, res = 5)
plor(r)
plot(r)
q <- resample(q, r)
res(q)
plot(q)
layers <- build_layers(q)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
layers@layers
final <- layers@layers[[3]]
r <- raster(ext, res = 20)
final <- resample(final, r)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
layers@layers[[3]] <- resample(layers@layers[[3]], r)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
layers <- build_layers(q)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
r <- raster(ext, res = 20)
layers@layers[[4]] <- resample(layers@layers[[3]], r)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
dim(layers@layers[[4]])
######################################################
# Purpose: Get topographical wetness index (TWI) for each quadrat in plot
# Developed by: Ian McGregor - mcgregori@si.edu &
#               Valentine Herrmann - herrmannv@si.edu
# R version 3.5.3 - First created July 2019
######################################################
library(rgdal)
library(raster)
##If these x and y min/max aren't working or dimensions need to be more exact, use the extent from the shapefile above
ext <-  extent(747375, 747783, 4308510, 4309155)
xy <- abs(apply(as.matrix(bbox(ext)), 1, diff))
n <- 5
r <- raster(ext, ncol=xy[1]*n, nrow=xy[2]*n)
proj4string(r) <- CRS("+proj=utm +zone=17 +datum=NAD83 +units=m +no_defs +ellps=GRS80 +towgs84=0,0,0")
#2 Get elevation raster from online
q <- get_elev_raster(r, z=14)
library(elevatr)
library(dynatopmodel)
#2 Get elevation raster from online
q <- get_elev_raster(r, z=14)
#3 Crop online raster to the dimensions of the empty raster, match resolutions
r <- raster(ext, res = 5)
q <- resample(q, r)
res(q)
plot(q)
#4 Get hydrological features of landscape (upslope area and topographical wetness index)
##graphing parameters comes from help text from build_layers
layers <- build_layers(q)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
#5 Redefine resolution to match 20m quadrats of plot
r <- raster(ext, res = 20)
layers@layers[[4]] <- resample(layers@layers[[3]], r)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))"))
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))", "TWI per quadrat"))
layers@layers[[4]]
hist(layers@layers[[4]])
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))", "TWI per quadrat"))
rivers <- layers@layers[[4]]
rivers <- layers@layers[[2]]
rivers <- layers@layers[[3]]
plot(rivers[rivrs > 10])
rivers <- layers@layers[[3]]
plot(rivers[rivers > 10])
rivers[rivers > 10]
rivers[rivers > 10] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 10] <- NA
plot(rivers)
rivers[rivers < 8] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 8] <- NA
plot(rivers)
rivers[rivers < 9] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 9] <- NA
plot(rivers)
rivers[rivers < 9.5] <- NA
plot(rivers)
rivers[rivers < 9] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 9] <- NA
plot(rivers)
rivers[rivers < 8] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 8] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 8.5] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 8.9] <- NA
plot(rivers)
rivers <- layers@layers[[3]]
rivers[rivers < 8.5] <- NA
plot(rivers)
sp::plot(layers, main=c("Elevation AMSL (m)", "Upslope area (log(m^2/m))", "TWI ((log(m^2/m))", "TWI per quadrat"))
?writeRaster
