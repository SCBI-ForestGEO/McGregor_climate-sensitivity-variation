if(save.plots)  {
png(paste0("manuscript/tables_figures/Time_series_for_each_species.png"), res = 300, width = 150, height = 150, units = "mm", pointsize = 10)
}
par(mfrow = c(length(SPECIES_IN_ORDER) + 3, 1), mar = c(0,0,0,0), oma = c(4, 6, 0, 0))
# pet_sum ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(100, 160))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pet_sum ~ year, data = clim, col  = "red", lwd = 2)
text(x = 2010, y = 130, "PET", pos = 4, col = "red")
axis(2, at = c(110, 130, 150), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), las = 1, cex = 0.7, line = 3)
# pre ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(40, 180))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pre ~ year, data = clim, col  = "blue",lwd = 2)
text(x = 2010, y = 100, "PRE", pos = 4, col = "blue")
axis(2, at = c(60, 110, 160), las = 1)
mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = 0)
# axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# pdsi ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(-7, 5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pdsi ~ year, data = clim, col  = "black", lwd = 2)
text(x = 2010, y = 0, "PDSI", pos = 4, col = "black")
axis(2, at = c(-4, 0, 4), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = -0.5)
axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# chronologies ####
for(f in SPECIES_IN_ORDER) {
if (f %in% "CAOV") f <- "CAOVL"
# get the detrended data
core <- read.table(paste0("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/cores/", f, "/ARSTANfiles/", tolower(f), "_drop.rwl_tabs.txt"), sep = "\t", h = T)
years.with.enough.sss <- all_sss[all_sss$Species %in% f & all_sss$sss >= sss.threshold, ]$Year
years.with.enough.sss <- years.with.enough.sss[years.with.enough.sss >= 1950 & years.with.enough.sss <= 2009]
core <- core[core$year %in% years.with.enough.sss, ] # trim to use only years for which with have clim data
if (f %in% "CAOVL") f <- "CAOV"
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(0.5, 1.5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1959, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1959, 2000, by = 20)
lines(res ~ year, data = core,
col = colors.species[which(SPECIES_IN_ORDER %in% f)])
axis(2, at = c(0.7, 1, 1.3), las = 1)
text(x = 2010, y = 1, f, pos = 4, col = colors.species[which(SPECIES_IN_ORDER %in% f)])
}
axis(1)
mtext(side = 1, "Year", outer = T, line = 2.5)
mtext(side = 2, "Ring Width Index", outer = T, line = 4)
plot1 <- recordPlot()
trees_all_sub <- read.csv("manuscript/tables_figures/trees_all_sub.csv")
trees_all_sub$year <- as.character(trees_all_sub$year)
plot2 <-
ggplot(trees_all_sub) +
aes(x = resist.value, fill = year) +
geom_density(adjust = 1L, alpha=.5) +
geom_vline(xintercept=1) +
scale_fill_hue(labels=c("1966", "1977", "1999")) +
labs(x="resistance value") +
theme_minimal()
plot_grid(plot1, plot2, nrow=2, ncol=1)
install.packages("gridGraphics")
library(gridGraphics) #for end
plot_grid(plot1, plot2, nrow=2, ncol=1)
plot_grid(plot1, plot2, nrow=2, ncol=1)
library(grid)
warnings()
library(grid)
?viewport
library(cowplot) #for end
library(ggplot2) #for end
library(gridGraphics) #for end
# time series for each species ####
SPECIES_IN_ORDER <- c("LITU", "QUAL", "QURU", "QUVE", "QUPR", "FRAM", "CAGL", "JUNI",
"CATO", "CACO", "FAGR", "CAOV")
all_sss <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/results/SSS_as_a_function_of_the_number_of_trees_in_sample.csv")
sss.threshold = 0.75
colors.species <- colorRampPalette(c("purple", "cadetblue", "darkorange", "red", "violetred4"))(length(SPECIES_IN_ORDER))
clim <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/climate/Formated_CRU_SCBI_1901_2016.csv")
clim_PDSI <- read.csv("data/pdsi/pdsi_timeseries_winchester_1949-2012.csv", stringsAsFactors = F)
clim_PDSI$year <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 3)
clim_PDSI$month <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 1)
names(clim_PDSI) <- c("Date", "pdsi", "year", "month")
clim <- merge(clim, clim_PDSI[, -1], by = c("year", "month"), all.x = T)
clim <- clim[clim$month %in% c(5:7), c("year", "pre", "pet_sum", "pdsi")]
clim <- clim[clim$year <= 2009 & clim$year >= 1901,]
clim <- data.frame(apply(clim, 2, function(x) tapply(x, clim$year, mean)))
clim <- clim[clim$year >= 1950, ]
# drought_years <- clim$year[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))]
# cbind(drought_years, c(clim$pet_sum - clim$pre)[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))])
drought_years <- c(1966, 1977, 1999)
pre_drought_years <- drought_years - 5
# create plot ####
if(save.plots)  {
png(paste0("manuscript/tables_figures/Time_series_for_each_species.png"), res = 300, width = 150, height = 150, units = "mm", pointsize = 10)
}
par(mfrow = c(length(SPECIES_IN_ORDER) + 3, 1), mar = c(0,0,0,0), oma = c(4, 6, 0, 0))
# pet_sum ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(100, 160))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pet_sum ~ year, data = clim, col  = "red", lwd = 2)
text(x = 2010, y = 130, "PET", pos = 4, col = "red")
axis(2, at = c(110, 130, 150), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), las = 1, cex = 0.7, line = 3)
# pre ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(40, 180))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pre ~ year, data = clim, col  = "blue",lwd = 2)
text(x = 2010, y = 100, "PRE", pos = 4, col = "blue")
axis(2, at = c(60, 110, 160), las = 1)
mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = 0)
# axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# pdsi ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(-7, 5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pdsi ~ year, data = clim, col  = "black", lwd = 2)
text(x = 2010, y = 0, "PDSI", pos = 4, col = "black")
axis(2, at = c(-4, 0, 4), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = -0.5)
axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# chronologies ####
for(f in SPECIES_IN_ORDER) {
if (f %in% "CAOV") f <- "CAOVL"
# get the detrended data
core <- read.table(paste0("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/cores/", f, "/ARSTANfiles/", tolower(f), "_drop.rwl_tabs.txt"), sep = "\t", h = T)
years.with.enough.sss <- all_sss[all_sss$Species %in% f & all_sss$sss >= sss.threshold, ]$Year
years.with.enough.sss <- years.with.enough.sss[years.with.enough.sss >= 1950 & years.with.enough.sss <= 2009]
core <- core[core$year %in% years.with.enough.sss, ] # trim to use only years for which with have clim data
if (f %in% "CAOVL") f <- "CAOV"
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(0.5, 1.5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1959, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1959, 2000, by = 20)
lines(res ~ year, data = core,
col = colors.species[which(SPECIES_IN_ORDER %in% f)])
axis(2, at = c(0.7, 1, 1.3), las = 1)
text(x = 2010, y = 1, f, pos = 4, col = colors.species[which(SPECIES_IN_ORDER %in% f)])
}
axis(1)
mtext(side = 1, "Year", outer = T, line = 2.5)
mtext(side = 2, "Ring Width Index", outer = T, line = 4)
trees_all_sub <- read.csv("manuscript/tables_figures/trees_all_sub.csv")
trees_all_sub$year <- as.character(trees_all_sub$year)
plot2 <-
ggplot(trees_all_sub) +
aes(x = resist.value, fill = year) +
geom_density(adjust = 1L, alpha=.5) +
geom_vline(xintercept=1) +
scale_fill_hue(labels=c("1966", "1977", "1999")) +
labs(x="resistance value") +
theme_minimal()
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(0.5, "npc"),
just=c("bottom"))
print(plot2, vp=vp.BottomRight)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"))
print(plot2, vp=vp.BottomRight)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0, "npc"), y=unit(0, "npc"))
print(plot2, vp=vp.BottomRight)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0.5, "npc"), y=unit(0, "npc"))
print(plot2, vp=vp.BottomRight)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0.6, "npc"), y=unit(-0.5, "npc"))
print(plot2, vp=vp.BottomRight)
# time series for each species ####
SPECIES_IN_ORDER <- c("LITU", "QUAL", "QURU", "QUVE", "QUPR", "FRAM", "CAGL", "JUNI",
"CATO", "CACO", "FAGR", "CAOV")
all_sss <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/results/SSS_as_a_function_of_the_number_of_trees_in_sample.csv")
sss.threshold = 0.75
colors.species <- colorRampPalette(c("purple", "cadetblue", "darkorange", "red", "violetred4"))(length(SPECIES_IN_ORDER))
clim <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/climate/Formated_CRU_SCBI_1901_2016.csv")
clim_PDSI <- read.csv("data/pdsi/pdsi_timeseries_winchester_1949-2012.csv", stringsAsFactors = F)
clim_PDSI$year <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 3)
clim_PDSI$month <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 1)
names(clim_PDSI) <- c("Date", "pdsi", "year", "month")
clim <- merge(clim, clim_PDSI[, -1], by = c("year", "month"), all.x = T)
clim <- clim[clim$month %in% c(5:7), c("year", "pre", "pet_sum", "pdsi")]
clim <- clim[clim$year <= 2009 & clim$year >= 1901,]
clim <- data.frame(apply(clim, 2, function(x) tapply(x, clim$year, mean)))
clim <- clim[clim$year >= 1950, ]
# drought_years <- clim$year[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))]
# cbind(drought_years, c(clim$pet_sum - clim$pre)[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))])
drought_years <- c(1966, 1977, 1999)
pre_drought_years <- drought_years - 5
# create plot ####
if(save.plots)  {
png(paste0("manuscript/tables_figures/Time_series_for_each_species.png"), res = 300, width = 150, height = 150, units = "mm", pointsize = 10)
}
par(mfrow = c(length(SPECIES_IN_ORDER) + 3, 1), mar = c(0,0,0,0), oma = c(4, 6, 0, 0))
# pet_sum ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(100, 160))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pet_sum ~ year, data = clim, col  = "red", lwd = 2)
text(x = 2010, y = 130, "PET", pos = 4, col = "red")
axis(2, at = c(110, 130, 150), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), las = 1, cex = 0.7, line = 3)
# pre ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(40, 180))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pre ~ year, data = clim, col  = "blue",lwd = 2)
text(x = 2010, y = 100, "PRE", pos = 4, col = "blue")
axis(2, at = c(60, 110, 160), las = 1)
mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = 0)
# axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# pdsi ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(-7, 5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pdsi ~ year, data = clim, col  = "black", lwd = 2)
text(x = 2010, y = 0, "PDSI", pos = 4, col = "black")
axis(2, at = c(-4, 0, 4), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = -0.5)
axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# chronologies ####
for(f in SPECIES_IN_ORDER) {
if (f %in% "CAOV") f <- "CAOVL"
# get the detrended data
core <- read.table(paste0("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/cores/", f, "/ARSTANfiles/", tolower(f), "_drop.rwl_tabs.txt"), sep = "\t", h = T)
years.with.enough.sss <- all_sss[all_sss$Species %in% f & all_sss$sss >= sss.threshold, ]$Year
years.with.enough.sss <- years.with.enough.sss[years.with.enough.sss >= 1950 & years.with.enough.sss <= 2009]
core <- core[core$year %in% years.with.enough.sss, ] # trim to use only years for which with have clim data
if (f %in% "CAOVL") f <- "CAOV"
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(0.5, 1.5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1959, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1959, 2000, by = 20)
lines(res ~ year, data = core,
col = colors.species[which(SPECIES_IN_ORDER %in% f)])
axis(2, at = c(0.7, 1, 1.3), las = 1)
text(x = 2010, y = 1, f, pos = 4, col = colors.species[which(SPECIES_IN_ORDER %in% f)])
}
axis(1)
mtext(side = 1, "Year", outer = T, line = 2.5)
mtext(side = 2, "Ring Width Index", outer = T, line = 4)
print(plot2, vp=vp.BottomRight)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0.6, "npc"), y=unit(-0.5, "npc"),
yscale=-0.5:1)
print(plot2, vp=vp.BottomRight)
# time series for each species ####
SPECIES_IN_ORDER <- c("LITU", "QUAL", "QURU", "QUVE", "QUPR", "FRAM", "CAGL", "JUNI",
"CATO", "CACO", "FAGR", "CAOV")
all_sss <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/results/SSS_as_a_function_of_the_number_of_trees_in_sample.csv")
sss.threshold = 0.75
colors.species <- colorRampPalette(c("purple", "cadetblue", "darkorange", "red", "violetred4"))(length(SPECIES_IN_ORDER))
clim <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/climate/Formated_CRU_SCBI_1901_2016.csv")
clim_PDSI <- read.csv("data/pdsi/pdsi_timeseries_winchester_1949-2012.csv", stringsAsFactors = F)
clim_PDSI$year <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 3)
clim_PDSI$month <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 1)
names(clim_PDSI) <- c("Date", "pdsi", "year", "month")
clim <- merge(clim, clim_PDSI[, -1], by = c("year", "month"), all.x = T)
clim <- clim[clim$month %in% c(5:7), c("year", "pre", "pet_sum", "pdsi")]
clim <- clim[clim$year <= 2009 & clim$year >= 1901,]
clim <- data.frame(apply(clim, 2, function(x) tapply(x, clim$year, mean)))
clim <- clim[clim$year >= 1950, ]
# drought_years <- clim$year[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))]
# cbind(drought_years, c(clim$pet_sum - clim$pre)[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))])
drought_years <- c(1966, 1977, 1999)
pre_drought_years <- drought_years - 5
# create plot ####
if(save.plots)  {
png(paste0("manuscript/tables_figures/Time_series_for_each_species.png"), res = 300, width = 150, height = 150, units = "mm", pointsize = 10)
}
par(mfrow = c(length(SPECIES_IN_ORDER) + 3, 1), mar = c(0,0,0,0), oma = c(4, 6, 0, 0))
# pet_sum ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(100, 160))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pet_sum ~ year, data = clim, col  = "red", lwd = 2)
text(x = 2010, y = 130, "PET", pos = 4, col = "red")
axis(2, at = c(110, 130, 150), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), las = 1, cex = 0.7, line = 3)
# pre ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(40, 180))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pre ~ year, data = clim, col  = "blue",lwd = 2)
text(x = 2010, y = 100, "PRE", pos = 4, col = "blue")
axis(2, at = c(60, 110, 160), las = 1)
mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = 0)
# axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# pdsi ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(-7, 5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pdsi ~ year, data = clim, col  = "black", lwd = 2)
text(x = 2010, y = 0, "PDSI", pos = 4, col = "black")
axis(2, at = c(-4, 0, 4), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = -0.5)
axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# chronologies ####
for(f in SPECIES_IN_ORDER) {
if (f %in% "CAOV") f <- "CAOVL"
# get the detrended data
core <- read.table(paste0("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/cores/", f, "/ARSTANfiles/", tolower(f), "_drop.rwl_tabs.txt"), sep = "\t", h = T)
years.with.enough.sss <- all_sss[all_sss$Species %in% f & all_sss$sss >= sss.threshold, ]$Year
years.with.enough.sss <- years.with.enough.sss[years.with.enough.sss >= 1950 & years.with.enough.sss <= 2009]
core <- core[core$year %in% years.with.enough.sss, ] # trim to use only years for which with have clim data
if (f %in% "CAOVL") f <- "CAOV"
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(0.5, 1.5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1959, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1959, 2000, by = 20)
lines(res ~ year, data = core,
col = colors.species[which(SPECIES_IN_ORDER %in% f)])
axis(2, at = c(0.7, 1, 1.3), las = 1)
text(x = 2010, y = 1, f, pos = 4, col = colors.species[which(SPECIES_IN_ORDER %in% f)])
}
axis(1)
mtext(side = 1, "Year", outer = T, line = 2.5)
mtext(side = 2, "Ring Width Index", outer = T, line = 4)
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0.6, "npc"), y=unit(-0.5, "npc"),
yscale=-0.5:1)
print(plot2, vp=vp.BottomRight)
?layout
par(mfrow=c(2,1))
vp.BottomRight <- viewport(height=unit(.5, "npc"), width=unit(1, "npc"),
just=c("bottom"),x=unit(0.6, "npc"), y=unit(0, "npc"))
print(plot2, vp=vp.BottomRight)
?matrix
# time series for each species ####
SPECIES_IN_ORDER <- c("LITU", "QUAL", "QURU", "QUVE", "QUPR", "FRAM", "CAGL", "JUNI",
"CATO", "CACO", "FAGR", "CAOV")
all_sss <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/results/SSS_as_a_function_of_the_number_of_trees_in_sample.csv")
sss.threshold = 0.75
colors.species <- colorRampPalette(c("purple", "cadetblue", "darkorange", "red", "violetred4"))(length(SPECIES_IN_ORDER))
clim <- read.csv("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/climate/Formated_CRU_SCBI_1901_2016.csv")
clim_PDSI <- read.csv("data/pdsi/pdsi_timeseries_winchester_1949-2012.csv", stringsAsFactors = F)
clim_PDSI$year <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 3)
clim_PDSI$month <- sapply(strsplit(clim_PDSI$Date, "/"), "[[", 1)
names(clim_PDSI) <- c("Date", "pdsi", "year", "month")
clim <- merge(clim, clim_PDSI[, -1], by = c("year", "month"), all.x = T)
clim <- clim[clim$month %in% c(5:7), c("year", "pre", "pet_sum", "pdsi")]
clim <- clim[clim$year <= 2009 & clim$year >= 1901,]
clim <- data.frame(apply(clim, 2, function(x) tapply(x, clim$year, mean)))
clim <- clim[clim$year >= 1950, ]
# drought_years <- clim$year[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))]
# cbind(drought_years, c(clim$pet_sum - clim$pre)[which(c(clim$pet_sum - clim$pre) >= (sort(clim$pet_sum - clim$pre, decreasing = T)[10]))])
drought_years <- c(1966, 1977, 1999)
pre_drought_years <- drought_years - 5
# create plot ####
if(save.plots)  {
png(paste0("manuscript/tables_figures/Time_series_for_each_species.png"), res = 300, width = 150, height = 150, units = "mm", pointsize = 10)
}
par(mfrow = c(length(SPECIES_IN_ORDER) + 3, 1), mar = c(0,0,0,0), oma = c(4, 6, 0, 0))
# pet_sum ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(100, 160))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pet_sum ~ year, data = clim, col  = "red", lwd = 2)
text(x = 2010, y = 130, "PET", pos = 4, col = "red")
axis(2, at = c(110, 130, 150), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), las = 1, cex = 0.7, line = 3)
# pre ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(40, 180))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pre ~ year, data = clim, col  = "blue",lwd = 2)
text(x = 2010, y = 100, "PRE", pos = 4, col = "blue")
axis(2, at = c(60, 110, 160), las = 1)
mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = 0)
# axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# pdsi ####
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(-7, 5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1950, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1950, 2000, by = 20)
lines(pdsi ~ year, data = clim, col  = "black", lwd = 2)
text(x = 2010, y = 0, "PDSI", pos = 4, col = "black")
axis(2, at = c(-4, 0, 4), las = 1)
# mtext(side = 2, text = expression("(mm mo"^-1*")"), line = 3, adj = -0.5)
axis(1, at = c(1700, 2015), labels = F, tck = 0, col = "grey60")
# chronologies ####
for(f in SPECIES_IN_ORDER) {
if (f %in% "CAOV") f <- "CAOVL"
# get the detrended data
core <- read.table(paste0("https://raw.githubusercontent.com/SCBI-ForestGEO/climate_sensitivity_cores/master/data/cores/", f, "/ARSTANfiles/", tolower(f), "_drop.rwl_tabs.txt"), sep = "\t", h = T)
years.with.enough.sss <- all_sss[all_sss$Species %in% f & all_sss$sss >= sss.threshold, ]$Year
years.with.enough.sss <- years.with.enough.sss[years.with.enough.sss >= 1950 & years.with.enough.sss <= 2009]
core <- core[core$year %in% years.with.enough.sss, ] # trim to use only years for which with have clim data
if (f %in% "CAOVL") f <- "CAOV"
plot(NULL,
axes = F,
ann = F,
xlim = c(1950,2015), ylim = c(0.5, 1.5))
rect(xleft = pre_drought_years, ybottom = par("usr")[3],
xright = drought_years, ytop = par("usr")[4],  col = adjustcolor(c("#FF9999", "#FF9999", "#FF9999", "#009900", "#6699CC"), alpha.f=0.5), border = "transparent")
# abline(v = pre_drought_years, col = "grey", lty = 2) # seq(1959, 2000, by = 20)
abline(v = drought_years, col = "grey50", lty = 2) # seq(1959, 2000, by = 20)
lines(res ~ year, data = core,
col = colors.species[which(SPECIES_IN_ORDER %in% f)])
axis(2, at = c(0.7, 1, 1.3), las = 1)
text(x = 2010, y = 1, f, pos = 4, col = colors.species[which(SPECIES_IN_ORDER %in% f)])
}
axis(1)
mtext(side = 1, "Year", outer = T, line = 2.5)
mtext(side = 2, "Ring Width Index", outer = T, line = 4)
plot.new()              ## suggested by @Josh
vps <- baseViewports()
library(gridBase)
install.packages("gridBase")
library(gridBase)
vps <- baseViewports()
pushViewport(vps$figure) ##   I am in the space of the autocorrelation plot
vp1 <-plotViewport(c(1.8,1,0,1))
print(plot2, vp=vp1)
vp1 <-plotViewport(c(1.8,0,0,0))
print(plot2, vp=vp1)
vps <- baseViewports()
pushViewport(vps$figure) ##   I am in the space of the autocorrelation plot
vp1 <-plotViewport(c(0,0,0,0))
print(plot2, vp=vp1)
